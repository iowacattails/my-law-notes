<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Law Notes Publisher</title>
<style>
body{font-family:Arial;background:#111;color:#fff;margin:0;padding:20px}
.c{max-width:900px;margin:auto;background:#1a1a1;padding:25px;border-radius:12px;box-shadow:0 0 20px rgba(212,175,55,.5)}
h1{text-align:center;color:#d4af37;text-shadow:0 0 10px gold;margin-bottom:30px;font-size:32px}
label{display:block;margin:15px 0 8px;color:#d4af37;font-weight:bold}
input,textarea{width:100%;padding:12px;background:#333;border:2px solid #d4af37;color:white;border-radius:8px;box-sizing:border-box;font-size:16px}
textarea{min-height:200px;resize:vertical}
.tags{display:flex;flex-wrap:wrap;gap:10px;margin:15px 0 20px}
.tag-btn{background:#444;padding:8px 16px;border-radius:20px;cursor:pointer}
.tag-btn.selected{background:#d4af37;color:#000}
button{background:#d4af37;color:#000;font-weight:bold;padding:16px 32px;border:none;border-radius:8px;cursor:pointer;font-size:20px;margin:10px 10px 10px 0}
button:hover{background:gold}
#preview{margin-top:30px;padding:20px;background:linear-gradient(90deg,#fffacd 50%,#ffffe0 50%);border:3px solid #d4af37;border-radius:10px;display:none;color:#000}
.stripe{background:background:repeating-linear-gradient(90deg,transparent,transparent 49px,#d4af37 49px,#d4af37 50px);padding:20px;border-radius:8px}
.note-title{font-size:28px;color:#b8860b;text-align:center;margin:0 0 20px}
#image-preview{max-width:100%;margin:15px 0;border:3px solid #d4af37;border-radius:8px;display:none}
.section{margin-top:40px;padding-top:20px;border-top:2px dashed #d4af37}
</style>
</head>
<body>
<div class="c">
  <h1>Law Notes Publisher</h1>

  <div id="sections"></div>

  <button onclick="addSection()">+ Add Another Note Section</button>
  <button onclick="previewAll()">Live Preview All</button>
  <button onclick="publishEverything()" style="background:gold;font-size:24px">Publish Everything to GitHub</button>

  <div id="preview"></div>
  <p style="text-align:center;margin-top:40px"><a href="index.html">All Law Notes</a></p>
</div>

<script>
<script>
let sectionId = 0;

const tagList = ["Common Law","Trial by Jury","Natural Rights","Due Process","Magna Carta","Abrogation","Vattel","Locke"];

function addSection() {
  sectionId++;
  const s = document.createElement('div');
  s.className = 'section';
  s.innerHTML = `
    <h2 style="color:#d4af37;text-align:center">Section ${sectionId}</h2>
    <label>Title</label>
    <input type="text" class="title">

    <label>Tags (tap presets or type)</label>
    <div class="tags" id="tags-${sectionId}"></div>
    <input type="text" class="custom-tags" placeholder="extra tags, comma-separated">

    <label>Body of Note</label>
    <textarea class="content"></textarea>

    <label>Add Image → opens GitHub ready to save</label>
    <input type="file" class="image" accept="image/*">
    <img class="img-prev" style="display:none">

    <label>Source (link/book)</label>
    <input type="text" class="source">

    <label>Citation (quote/reference)</label>
    <input type="text" class="citation">
  `;
  document.getElementById('sections').appendChild(s);

  // add tag buttons
  const tagDiv = document.getElementById(`tags-${sectionId}`);
  tagList.forEach(t=>{
    const b=document.createElement('span');
    b.className='tag-btn';
    b.textContent=t;
    b.onclick=()=>b.classList.toggle('selected');
    tagDiv.appendChild(b);
  });
}

function getSections() {
  const secs = [];
  document.querySelectorAll('.section').forEach(sec=>{
    const selected = Array.from(sec.querySelectorAll('.tag-btn.selected')).map(b=>b.textContent);
    const custom = sec.querySelector('.custom-tags').value.split(',').map(t=>t.trim()).filter(t=>t);
    const allTags = [...selected,...custom].join(' · ');
    const file = sec.querySelector('.image').files[0];
    let img = '';
    if(file){
      const name = prompt('Image filename (with extension)',file.name)||file.name;
      img = `images/${name}`;
      const r=new FileReader();
      r.onload=e=>sec.querySelector('.img-prev').src=e.target.result;
      r.readAsDataURL(file);
      window.open(`https://github.com/iowacattails/my-law-notes/upload/main/images`,'_blank');
    }
    secs.push({
      title: sec.querySelector('.title').value.trim()||'Untitled',
      tags: allTags,
      body: sec.querySelector('.content').value.replace(/\n/g,'<br>') + (img?`<br><img src="${img}" style="max-width:100%;border-radius:8px">`:'''),
      source: sec.querySelector('.source').value.trim(),
      citation: sec.querySelector('.citation').value.trim()
    });
  });
  return secs;
}

function previewAll(){
  const secs = getSections();
  let h = '';
  secs.forEach(s=>{
    h += `<div class="note-title">${s.title}</div>${s.tags?`<p style="text-align:center;color:#b8860b"><strong>${s.tags}</strong></p>`:''}<div class="stripe">${s.body}</div>${s.source?`<p style="text-align:center">Source: <a href="${s.source}" style="color:#d4af37">${s.source}</a></p>`:''}${s.citation?`<p style="text-align:center;font-style:italic">${s.citation}</p>`:''}<hr style="border-color:#d4af37">`;
  });
  document.getElementById('preview').innerHTML = h;
  document.getElementById('preview').style.display = 'block';
}

function publishEverything(){
  previewAll();
  const secs = getSections();
  const pageTitle = prompt("Final page title?", secs[0].title || "Law Note");
  const fn = pageTitle.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'') + '.html';
  let body = '';
  secs.forEach(s=>body += `<div class="note-title">${s.title}</div>${s.tags?`<div style="text-align:center;color:#b8860b;margin:20px"><strong>${s.tags}</strong></div>`:''}<div class="stripe">${s.body}</div>${s.source?`<p style="text-align:center">Source: <a href="${s.source}">${s.source}</a></p>`:''}${s.citation?`<p style="text-align:center;font-style:italic">${s.citation}</p>`:''}<hr style="border-color:#d4af37;margin:50px 0">`);
  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${pageTitle}</title><style>body{background:#111;color:#fff;font-family:Arial;padding:20px}.note{max-width:900px;margin:auto;background:linear-gradient(90deg,#fffacd 50%,#ffffe0 50%);color:#000;padding:30px;border-radius:12px;box-shadow:0 0 20px gold}h1,h2{color:#b8860b;text-align:center;text-shadow:0 0 10px gold}.stripe{background:repeating-linear-gradient(90deg,transparent,transparent 49px,#d4af37 49px,#d4af37 50px);padding:20px;border-radius:8px}a{color:#d4af37}img{max-width:100%;border-radius:8px}</style></head><body><div class="note"><h1>${pageTitle}</h1>${body}<p style="text-align:center"><a href="index.html">All Law Notes</a></p></div></body></html>`;
  window.open(`https://github.com/iowacattails/my-law-notes/new/main?filename=${fn}&value=${encodeURIComponent(html)}`,'_blank');
  alert("Image tabs already opened → commit them → then commit the note. Done!");
}

// start with one section
addSection();
</script>
</body>
</html>
