<!DOCTYPE html>
<html><head><meta charset="utf-8"><title>New Law Note</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
  body{font:18px/1.6 Georgia,serif;max-width:600px;margin:40px auto;padding:20px;background:#fdfdfd}
  input,textarea,button{width:100%;margin:12px 0;padding:14px;font:18px Georgia,serif;box-sizing:border-box;border:1px solid #ccc;border-radius:8px}
  button{background:#1a5fb4;color:white;font-weight:bold;border:none;cursor:pointer}
  #preview{background:#f8f8f8;padding:20px;border:1px solid #eee;margin:20px 0;border-radius:8px}
  img{max-width:100%;border-radius:8px}
</style></head><body>

<h1>New Law Note</h1>
<form id="f">
  <input required placeholder="Title" id="title">
  <input placeholder="Citation (optional)" id="citation">
  <textarea required rows=9 placeholder="Your note text…" id="body"></textarea>
  <input type=file accept="image/*" id="img">
  <input placeholder="Source link (optional)" id="link">
  <input placeholder="Tags (comma separated)" id="tags" value="law, constitution">
  <div id="preview"></div>
  <button type=submit>Publish Instantly</button>
</form>

<script>
document.getElementById('f').onsubmit = async e => {
  e.preventDefault();
  const data = {
    title: e.target.title.value.trim(),
    citation: e.target.citation.value.trim(),
    body: e.target.body.value.trim(),
    link: e.target.link.value.trim(),
    tags: e.target.tags.value.split(',').map(t=>t.trim()).filter(Boolean),
    image: ''
  };
  if (e.target.img.files[0]) {
    data.image = await new Promise(r=>{let fr=new FileReader();fr.onload=()=>r(fr.result);fr.readAsDataURL(e.target.img.files[0])});
  }

  const res = await fetch('https://api.github.com/repos/iowacattails/my-law-notes/dispatches', {
    method:'POST',
    headers: {'Accept':'application/vnd.github.v3+json'},
    body: JSON.stringify({event_type:'new-law-note', client_payload: data})
  });

  if (res.ok) {
    alert('Published! Refresh the index in 30–60 seconds.');
    e.target.reset(); document.getElementById('preview').innerHTML='';
  } else alert('Failed – check Actions tab');
};

// live preview
['title','citation','body','link','tags','img'].forEach(id=>document.getElementById(id).oninput=document.getElementById(id).onchange=()=> {
  const preview = `<h2>${document.getElementById('title').value||'Title'}</h2><em>${document.getElementById('citation').value}</em><br>${
    document.querySelector('#img').files[0] ? '<img src="'+URL.createObjectURL(document.querySelector('#img').files[0])+'"><br>' : ''
  }${document.getElementById('body').value.replace(/\n/g,'<br>')}`;
  document.getElementById('preview').innerHTML = preview;
});
</script>
</body></html>
