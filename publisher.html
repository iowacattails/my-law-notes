<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Law Notes Publisher</title>
<style>
  body {font-family:Arial;background:#111;color:#fff;margin:0;padding:10px 8px}
  .top {width:100%;padding:16px;font-size:22px;background:#333;border:4px solid #d4af37;color:white;border-radius:12px;text-align:center;margin-bottom:25px}
  label {display:block;margin:18px 0 8px;color:#d4af37;font-weight:bold;font-size:18px}
  input,textarea {width:100%;padding:14px;background:#333;border:3px solid #d4af37;color:white;border-radius:10px;box-sizing:border-box;font-size:17px}
  textarea {min-height:250px}
  .tags {display:flex;flex-wrap:wrap;gap:12px;margin:15px 0 20px}
  .tag-btn {background:#444;padding:9px 16px;border-radius:25px;cursor:pointer;font-size:15px}
  .tag-btn.selected {background:#d4af37;color:#000;font-weight:bold}
  button {background:#d4af37;color:#000;font-weight:bold;padding:18px 32px;border:none;border-radius:12px;cursor:pointer;font-size:20px;margin:12px 6px}
  button:hover {background:gold}
  #preview {margin:30px -8px 0;padding:35px;background:#ffffe0;color:#000;border:4px solid #d4af37;border-radius:15px;display:none;font-size:18px;line-height:1.6}
  .stripe {background:repeating-linear-gradient(90deg,transparent,transparent 49px,#d4af37 49px,#d4af37 50px);padding:30px;border-radius:2px solid #d4af37;border-radius:12px;margin:20px 0}
  #image-preview {max-width:100%;margin:20px 0;border-radius:12px}
  .section {margin-top:40px;padding-top:25px;border-top:3px dashed #d4af37}
</style>
</head>
<body>

  <input type="text" id="page-title" class="top" placeholder="Page Title">

  <div id="sections"></div>

  <div style="text-align:center;margin:40px 0">
    <button onclick="addSection()">+ Add Another Section</button>
    <button onclick="previewAll()">Live Preview</button>
    <button onclick="saveImageOnly()" style="background:#ff9500">Save Image to GitHub</button>
    <button onclick="saveNoteOnly()" style="background:gold;font-size:24px;padding:20px 50px">
      Save Note as .html
    </button>
  </div>

  <div id="preview"></div>

<script>
let sectionCount = 0;
const tagsList = ["Common Law","Trial by Jury","Natural Rights","Due Process","Magna Carta","Abrogation","Vattel","Locke"];

function addSection() {
  sectionCount++;
  const d = document.createElement('div');
  d.className = 'section';
  d.innerHTML = `
    <h2 style="color:#d4af37;text-align:center">Section ${sectionCount}</h2>
    <label>Tags</label>
    <div class="tags" id="t${sectionCount}"></div>
    <input type="text" class="ctags" placeholder="custom tags, comma-separated">
    <label>Body</label>
    <textarea class="body"></textarea>
    <label>Image</label>
    <input type="file" class="img" accept="image/*">
    <img class="prev" style="display:none;max-width:100%">
    <label>Source</label>
    <input type="text" class="src">
    <label>Citation</label>
    <input type="text" class="cit">
  `;
  document.getElementById('sections').appendChild(d);

  const tb = document.getElementById(`t${sectionCount}`);
  tagsList.forEach(t=>{const b=document.createElement('span');b.className='tag-btn';b.textContent=t;b.onclick=()=>b.classList.toggle('selected');tb.appendChild(b);});
}

function getData() {
  const secs = [];
  document.querySelectorAll('.section').forEach(s=>{
    const file = s.querySelector('.img').files[0];
    let img = '';
    if(file){
      const name = prompt('Image filename (with .jpg/.png)', file.name)||file.name;
      img = `images/${name}`;
      const r=new FileReader();
      r.onload=e=>s.querySelector('.prev').src=e.target.result;
      r.readAsDataURL(file);
      window.open(`https://github.com/iowacattails/my-law-notes/upload/main/images`,'_blank');
    }
    const tags = Array.from(s.querySelectorAll('.tag-btn.selected')).map(b=>b.textContent)
                 .concat(s.querySelector('.ctags').value.split(',').map(t=>t.trim()).filter(t=>t))
                 .join(' · ');
    secs.push({
      tags, body: s.querySelector('.body').value.replace(/\n/g,'<br>') + (img?`<br><img src="${img}">`:''),
      src: s.querySelector('.src').value.trim(),
      cit: s.querySelector('.cit').value.trim()
    });
  });
  return secs;
}

function previewAll() {
  const title = document.getElementById('page-title').value.trim() || 'Untitled';
  const secs = getData();
  let h = `<h1 style="text-align:center;color:#b8860b;font-size:32px;margin:30px 0">${title}</h1>`;
  secs.forEach(s=>{
    h += `${s.tags?`<p style="text-align:center;color:#b8860b;margin:20px"><strong>${s.tags}</strong></p>`:''}
           <div class="stripe">${s.body}</div>
           ${s.src?`<p style="text-align:center">Source: <a href="${s.src}" style="color:#d4af37">${s.src}</a></p>`:''}
           ${s.cit?`<p style="text-align:center;font-style:italic">${s.cit}</p>`:''}<hr style="border-color:#d4af37">`;
  });
  document.getElementById('preview').innerHTML = h;
  document.getElementById('preview').style.display = 'block';
}

function saveImageOnly() {
  document.querySelectorAll('.img').forEach(i=>{if(i.files[0]) i.dispatchEvent(new Event('change'));});
  alert("Image tabs opened — commit them first!");
}

function saveNoteOnly() {
  const title = document.getElementById('page-title').value.trim() || 'note';
  const fn = title.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'') + '.html';
  const secs = getData();
  let body = '';
  secs.forEach(s=>body += `${s.tags?`<p style="text-align:center;color:#b8860b"><strong>${s.tags}</strong></p>`:''}<div class="stripe">${s.body}</div>${s.src?`<p style="text-align:center">Source: <a href="${s.src}">${s.src}</a></p>`:''}${s.cit?`<p style="text-align:center;font-style:italic">${s.cit}</p>`:''}<hr style="border-color:#d4af37">`);
  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${title}</title><style>body{background:#111;color:#fff;font-family:Arial;padding:20px}.note{max-width:900px;margin:auto;background:#ffffe0;color:#000;padding:40px;border-radius:15px;border:4px solid #d4af37}h1,h2{color:#b8860b;text-align:center}.stripe{background:repeating-linear-gradient(90deg,transparent,transparent 49px,#d4af37 49px,#d4af37 50px);padding:30px;border-radius:12px}a{color:#d4af37}img{max-width:100%;border-radius:12px}</style></head><body><div class="note"><h1>${title}</h1>${body}<p style="text-align:center"><a href="index.html">All Law Notes</a></p></div></body></html>`;
  window.open(`https://github.com/iowacattails/my-law-notes/new/main?filename=${fn}&value=${encodeURIComponent(html)}`,'_blank');
  alert("Note tab opened — commit it!");
}

addSection();
</script>
</body>
</html>
