<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Law Note Publisher</title>
<style>
  body {background:#ff0;margin:0;padding:20px;font-family:Arial;}
  h1 {font-size:2.5em;text-align:center;margin:40px 0;}
  input,textarea,button {width:100%;padding:15px;margin:10px 0;font-size:1.2em;box-sizing:border-box;}
  button {background:#000;color:#ff0;border:none;padding:25px;font-weight:bold;cursor:pointer;}
  .section {border:4px solid #000;padding:30px;margin:30px 0;background:#fff;}
  .thumb {max-width:50%;margin:40px auto;display:block;border:4px solid #000;}
  #preview {background:#fff;padding:40px;margin-top:50px;border:4px solid #000;}
</style>
</head>
<body>

<h1>Law Note Publisher</h1>

<input type="text" id="title" placeholder="Page Title">

<div id="sections">
  <div class="section">
    <textarea rows="10" class="note" placeholder="Your note"></textarea>
    <div style="text-align:center;margin:20px 0;">
      <input type="file" accept="image/*" class="image" onchange="handleImage(this)">
      <img class="thumb" style="display:none;">
    </div>
    <button onclick="addPhoto(this)">+ Add Another Photo</button>
  </div>
</div>

<button onclick="publish()">PUBLISH â€” ONE TAP</button>

<div id="preview"><h2>Live Preview</h2><div id="previewContent"></div></div>

<script>
function addPhoto(b) {
  const d=document.createElement('div'); d.style.textAlign='center'; d.style.margin='20px 0';
  d.innerHTML=`<input type="file" accept="image/*" class="image" onchange="handleImage(this)"><img class="thumb" style="display:none;">`;
  b.parentNode.insertBefore(d,b);
}
function handleImage(i) { const m=i.nextElementSibling; if(i.files[0]) m.src=URL.createObjectURL(i.files[0]), m.style.display='block'; updatePreview(); }

function updatePreview() {
  let h=`<h1>${document.getElementById('title').value||'Untitled'}</h1><p>`;
  document.querySelectorAll('.note').forEach(n=>h+=n.value.trim().replace(/\n/g,'<br><br>')+'<br><br>');
  document.querySelectorAll('.thumb').forEach(m=>m.src&&m.style.display!=='none'&& (h+=`<br><div style="text-align:center"><img src="${m.src}" style="max-width:50%;"></div><br>`));
  h+=`<a href="index.html" style="display:block;background:#fff;color:#000;padding:30px;margin:60px auto;font-size:1.8em;border:4px solid #000;text-decoration:none;max-width:600px;text-align:center;font-weight:bold;">Return to Law Book Links</a>`;
  document.getElementById('previewContent').innerHTML=h;
}

async function publish() {
  if(!document.getElementById('title').value.trim()) return alert("Add a title");
  const f=new FormData();
  f.append('title',document.getElementById('title').value.trim());
  f.append('content',document.querySelector('.note').value);
  document.querySelectorAll('.image').forEach(i=>i.files[0]&&f.append('images',i.files[0]));
  const r=await fetch('https://grok-law-notes.vercel.app/api/publish', {method:'POST',body:f});
  const d=await r.json();
  if(r.ok) alert(`Published! "${d.title}" live with ${d.images} photos`), setTimeout(()=>location.reload(),4000);
  else alert('Error: '+d.error);
}
</script>

</body>
</html>
