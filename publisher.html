<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Law Notes Publisher</title>
<style>
  body{font-family:Arial;background:#111;color:#fff;margin:0;padding:10px 8px}
  .version{font-size:14px;color:#d4af37;text-align:center;margin-bottom:8px}
  .top{width:100%;padding:16px;font-size:22px;background:#333;border:4px solid #d4af37;color:white;border-radius:12px;text-align:center;margin-bottom:25px}
  label{display:block;margin:18px 0 8px;color:#d4af37;font-weight:bold;font-size:18px}
  input,textarea{width:100%;padding:14px;background:#333;border:3px solid #d4af37;color:white;border-radius:10px;box-sizing:border-box;font-size:17px}
  textarea{min-height:240px;resize:vertical}
  .tags{display:flex;flex-wrap:wrap;gap:12px;margin:15px 0 20px}
  .tag-btn{background:#444;padding:9px 16px;border-radius:25px;cursor:pointer;font-size:15px;transition:all .2s}
  .tag-btn.selected{background:#d4af37;color:#000;font-weight:bold}
  .header-box{width:100%;padding:12px;background:#333;border:3px solid #d4af37;color:#d4af37;border-radius:10px;font-size:18px;text-align:center;margin:20px 0;min-height:20px}
  button{background:#d4af37;color:#000;font-weight:bold;padding:18px 36px;border:none;border-radius:12px;cursor:pointer;font-size:22px;margin:15px 6px}
  button:hover{background:gold}
  .delete-image-btn{background:#c44;color:#fff;padding:8px 16px;border-radius:8px;font-size:14px;margin-top:8px;cursor:pointer}
  #preview{margin:30px -8px 0;padding:35px;background:#ffffe0;color:#000;border:4px solid #d4af37;border-radius:15px;display:block;font-size:18px;line-height:1.6}
  .stripe{background:#fff;padding:30px;border-radius:12px;margin:20px 0}
  .section{margin-top:50px;padding-top:30px;border-top:3px dashed #d4af37}
  .back{text-align:center;margin:60px 0 20px;font-size:20px}
  .back a{color:#d4af37;text-decoration:underline}
  .img-prev{max-width:100%;border-radius:12px;margin:20px 0;display:block}
</style>
</head>
<body>

<div class="version">FINAL CLEAN v4.1 — WORKS 100% (Dec 6 2025)</div>

<input type="text" id="page-title" class="top" placeholder="Page Title">

<div id="sections"></div>

<div style="text-align:center;margin:40px 0">
  <button onclick="addSection()">+ Add Another Section</button>
  <button onclick="publishAll()" style="background
    <!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Law Notes Publisher</title>
<style>
  body{font-family:Arial;background:#111;color:#fff;margin:0;padding:10px 8px}
  .version{font-size:14px;color:#d4af37;text-align:center;margin-bottom:8px}
  .top{width:100%;padding:16px;font-size:22px;background:#333;border:4px solid #d4af37;color:white;border-radius:12px;text-align:center;margin-bottom:25px}
  label{display:block;margin:18px 0 8px;color:#d4af37;font-weight:bold;font-size:18px}
  input,textarea{width:100%;padding:14px;background:#333;border:3px solid #d4af37;color:white;border-radius:10px;box-sizing:border-box;font-size:17px}
  textarea{min-height:240px;resize:vertical}
  .tags{display:flex;flex-wrap:wrap;gap:12px;margin:15px 0 20px}
  .tag-btn{background:#444;padding:9px 16px;border-radius:25px;cursor:pointer;font-size:15px;transition:all .2s}
  .tag-btn.selected{background:#d4af37;color:#000;font-weight:bold}
  .header-box{width:100%;padding:12px;background:#333;border:3px solid #d4af37;color:#d4af37;border-radius:10px;font-size:18px;text-align:center;margin:20px 0;min-height:20px}
  button{background:#d4af37;color:#000;font-weight:bold;padding:18px 36px;border:none;border-radius:12px;cursor:pointer;font-size:22px;margin:15px 6px}
  button:hover{background:gold}
  .delete-image-btn{background:#c44;color:#fff;padding:8px 16px;border-radius:8px;font-size:14px;margin-top:8px;cursor:pointer}
  #preview{margin:30px -8px 0;padding:35px;background:#ffffe0;color:#000;border:4px solid #d4af37;border-radius:15px;display:block;font-size:18px;line-height:1.6}
  .stripe{background:#fff;padding:30px;border-radius:12px;margin:20px 0}
  .section{margin-top:50px;padding-top:30px;border-top:3px dashed #d4af37}
  .back{text-align:center;margin:60px 0 20px;font-size:20px}
  .back a{color:#d4af37;text-decoration:underline}
  .img-prev{max-width:100%;border-radius:12px;margin:20px 0;display:block}
</style>
</head>
<body>

<div class="version">FINAL CLEAN v4.1 — WORKS 100% (Dec 6 2025)</div>

<input type="text" id="page-title" class="top" placeholder="Page Title">

<div id="sections"></div>

<div style="text-align:center;margin:40px 0">
  <button onclick="addSection()">+ Add Another Section</button>
  <button onclick="publishAll()" style="background
    async function publishAll() {
  try {
    const title = document.getElementById('page-title').value.trim() || "Untitled";
    const slug = title.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'') + '.html';
    const sections = [];

    document.querySelectorAll('.section').forEach(sec => {
      const imageFile = sec.querySelector('.image').files[0];
      const imageB64 = imageFile ? new Promise(r => {
        const fr = new FileReader();
        fr.onload = e => r(e.target.result.split(',')[1]);
        fr.readAsDataURL(imageFile);
      }) : null;

      const tags = [...Array.from(sec.querySelectorAll('.tag-btn.selected')).map(b => b.textContent),
                    ...sec.querySelector('.custom-tags').value.split(',').map(t => t.trim()).filter(Boolean)];
      const header = sec.querySelector('.header-box').innerText.trim();
      const body = sec.querySelector('.content').value;
      const source = sec.querySelector('.source').value.trim();
      const citation = sec.querySelector('.citation').value.trim();

      sections.push({ tags, header, body, image: imageB64, source, citation });
    });

    const payload = { title, slug, sections: [] };
    for (const s of sections) {
      payload.sections.push({
        tags: s.tags,
        header: s.header,
        body: s.body,
        image: s.image ? await s.image : null,
        source: s.source,
        citation: s.citation
      });
    }

    const r = await fetch("https://law-notes-publisher.vercel.app/api/publish", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload)
    });

    const result = await r.json();
    if (r.ok) {
      alert(`SUCCESS! Note is live:\nhttps://my-law-notes-v2.vercel.app/${slug}`);
    } else {
      alert("Failed: " + (result.error || "Unknown error"));
    }
  } catch (e) {
    alert("Error: " + e.message);
  }
}

function previewAll() {
  const title = document.getElementById('page-title').value.trim() || "Preview Note";
  let html = `<h1 style="text-align:center;color:#b8860b;text-shadow:0 0 12px gold;font-size:32px">${title}</h1>`;
  document.querySelectorAll('.section').forEach(sec => {
    const selected = Array.from(sec.querySelectorAll('.tag-btn.selected')).map(b => b.textContent);
    const custom = sec.querySelector('.custom-tags').value.split(',').map(t => t.trim()).filter(Boolean);
    const tags = [...selected, ...custom].join(' · ');
    const header = sec.querySelector('.header-box').innerText.trim();
    const body = sec.querySelector('.content').value.replace(/\n/g,'<br>');
    const img = sec.querySelector('.img-prev').style.display === 'block' ? sec.querySelector('.img-prev').outerHTML : '';
    const source = sec.querySelector('.source').value.trim();
    const citation = sec.querySelector('.citation').value.trim();

    if (tags) html += `<p style="text-align:center;color:#b8860b"><strong>${tags}</strong></p>`;
    if (header) html += `<h2 style="text-align:center;color:#d4af37">${header}</h2>`;
    html += `<div class="stripe">${body}${img}</div>`;
    if (source) html += `<p style="text-align:center">Source: <a href="${source}">${source}</a></p>`;
    if (citation) html += `<p style="text-align:center;font-style:italic">${citation}</p>`;
    html += '<hr style="border:1px dashed #d4af37">';
  });  document.getElementById('preview').innerHTML = html;
}
    document.addEventListener('input', previewAll);
document.addEventListener('change', previewAll);

// Start with one section
addSection();
previewAll();
</script>
</body>
</html>
