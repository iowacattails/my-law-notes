<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Law Notes Publisher</title>
<style>
body{font-family:Arial;background:#111;color:#fff;margin:0;padding:20px}
.c{max-width:900px;margin:auto;background:#1a1a1;padding:25px;border-radius:12px;box-shadow:0 0 20px rgba(212,175,55,.5)}
h1{text-align:center;color:#d4af37;text-shadow:0 0 10px gold}
label{display:block;margin:12px 0 6px;color:#d4af37;font-weight:bold}
input,textarea{width:100%;padding:10px;background:#333;border:2px solid #d4af37;color:#fff;border-radius:8px;box-sizing:border-box;font-size:16px}
textarea{min-height:180px;margin-bottom:15px}
.tags{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
.tag-btn{background:#444;padding:6px 12px;border-radius:20px;cursor:pointer;font-size:14px}
.tag-btn.selected{background:#d4af37;color:#000}
button{background:#d4af37;color:#000;font-weight:bold;padding:14px 24px;border:none;border-radius:8px;cursor:pointer;font-size:18px;margin:10px 5px 10px 0}
button:hover{background:gold}
#preview{margin-top:30px;padding:20px;background:linear-gradient(90deg,#fffacd 50%,#ffffe0 50%);border:3px solid #d4af37;border-radius:10px;display:none;color:#000}
.stripe{background:repeating-linear-gradient(90deg,transparent,transparent 49px,#d4af37 49px,#d4af37 50px);padding:20px;border-radius:8px}
.note-title{font-size:26px;color:#b8860b;text-align:center;margin:20px 0 10px}
.section{margin:40px 0 20px;padding-bottom:30px;border-bottom:3px solid #d4af37}
#image-preview{max-width:100%;border-radius:8px;margin:10px 0;display:none}
</style>
</head>
<body>
<div class="c">
<h1>Law Notes Publisher</h1>

<div id="sections">
  <!-- first section loads automatically -->
</div>

<button onclick="addSection()">+ Add Another Note Section</button>
<button onclick="previewAll()">Live Preview All</button>
<button onclick="publishEverything()" style="background:gold;font-size:22px">Publish Everything to GitHub</button>

<div id="preview"></div>
<p style="text-align:center;margin-top:40px"><a href="index.html">All Law Notes</a></p>
</div>

<script>
let sectionCount = 0;

function createSection() {
  sectionCount++;
  const div = document.createElement('div');
  div.className = 'section';
  div.innerHTML = `
    <h3 style="color:#d4af37">Note Section ${sectionCount}</h3>
    <label>Title</label>
    <input type="text" class="title" placeholder="Section title">

    <label>Tags</label>
    <div class="tags clone-tags-${sectionCount}"></div>
    <input type="text" class="custom-tags" placeholder="extra tags, comma-separated">

    <label>Body</label>
    <textarea class="content"></textarea>

    <label>Image</label>
    <input type="file" class="image" accept="image/*">
    <img class="img-prev" style="display:none">

    <label>Source (link/book)</label>
    <input type="text" class="source">

    <label>Citation (quote/ref)</label>
    <input type="text" class="citation">
  `;
  document.getElementById('sections').appendChild(div);

  // clone tag buttons
  const tagContainer = div.querySelector(`.clone-tags-${sectionCount}`);
  document.querySelectorAll('.master-tags .tag-btn').forEach(btn => {
    const clone = btn.cloneNode(true);
    clone.onclick = () => clone.classList.toggle('selected');
    tagContainer.appendChild(clone);
  });
}

function addSection() { createSection(); previewAll(); }

// master tag list (hidden)
document.write('<div class="master-tags" style="display:none">' +
  '<span class="tag-btn" data-tag="Common Law">Common Law</span>' +
  '<span class="tag-btn" data-tag="Trial by Jury">Trial by Jury</span>' +
  '<span class="tag-btn" data-tag="Natural Rights">Natural Rights</span>' +
  '<span class="tag-btn" data-tag="Due Process">Due Process</span>' +
  '<span class="tag-btn" data-tag="Magna Carta">Magna Carta</span>' +
  '<span class="tag-btn" data-tag="Abrogation">Abrogation</span>' +
  '<span class="tag-btn" data-tag="Vattel">Vattel</span>' +
  '<span class="tag-btn" data-tag="Locke">Locke</span>' +
'</div>');

// start with one section
createSection();

function getAllData() {
  const sections = [];
  document.querySelectorAll('.section').forEach(sec => {
    const tags = Array.from(sec.querySelectorAll('.tag-btn.selected')).map(b=>b.dataset.tag);
    const custom = sec.querySelector('.custom-tags').value.split(',').map(t=>t=>t.trim()).filter(t=>t);
    const imgFile = sec.querySelector('.image').files[0];
    let imgPath = '';
    if (imgFile) {
      let name = prompt('Image filename for this section', imgFile.name) || imgFile.name;
      imgPath = 'images/' + name;
      const reader = new FileReader();
      reader.onload = e => sec.querySelector('.img-prev').src = e.target.result;
      reader.readAsDataURL(imgFile);
      // open upload tab
      const win = window.open(`https://github.com/iowacattails/my-law-notes/upload/main/images`,'_blank');
      setTimeout(()=>win.document.body.innerHTML += '<p style="color:lime">Image ready — commit it!</p>',1500);
    }
    sections.push({
      title: sec.querySelector('.title').value.trim() || 'Untitled Section',
      tags: [...tags, ...custom].join(' · '),
      body: sec.querySelector('.content').value.replace(/\n/g,'<br>') + (imgPath?`<br><img src="${imgPath}" style="max-width:100%;border-radius:8px">`:'''),
      source: sec.querySelector('.source').value.trim(),
      citation: sec.querySelector('.citation').value.trim()
    });
  });
  return sections;
}

function previewAll() {
  const data = getAllData();
  let html = '';
  data.forEach(sec => {
    html += `<div class="note-title">${sec.title?'<div class="note-title">'+sec.title+'</div>':''}${sec.tags?'<p style="text-align:center;color:#b8860b"><strong>'+sec.tags+'</strong></p>':''}<div class="stripe">${sec.body}</div>${sec.source?'<p style="text-align:center">Source: <a href="'+sec.source+'" style="color:#d4af37">'+sec.source+'</a></p>':''}${sec.citation?'<p style="text-align:center;font-style:italic">'+sec.citation+'</p>':''}</div>`;
  });
  const prev = document.getElementById('preview');
  prev.innerHTML = html;
  prev.style.display = 'block';
}

function publishEverything() {
  previewAll();
  const data = getAllData();
  const pageTitle = prompt("Final page title for this whole note?", data[0].title || "My Law Note');
  const filename = pageTitle.toLowerCase().replace(/[^a-z0-9]+/g,'-').replace(/^-+|-+$/g,'') + '.html';

  let fullBody = '';
  data.forEach(sec => {
    fullBody += `<div class="note-title">${sec.title}</div>${sec.tags?'<p style="text-align:center;color:#b8860b"><strong>'+sec.tags+'</strong></p>':''}<div class="stripe">${sec.body}</div>${sec.source?'<p style="text-align:center">Source: <a href="'+sec.source+'">'+sec.source+'</a></p>':''}${sec.citation?'<p style="text-align:center;font-style:italic">'+sec.citation+'</p>':''}<hr style="border-color:#d4af37;margin:40px 0">';
  });

  const html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>${pageTitle}</title><style>body{background:#111;color:#fff;font-family:Arial;padding:20px}.note{max-width:900px;margin:auto;background:linear-gradient(90deg,#fffacd 50%,#ffffe0 50%);color:#000;padding:30px;border-radius:12px;box-shadow:0 0 20px gold}h2{color:#b8860b;text-align:center}.stripe{background:repeating-linear-gradient(90deg,transparent,transparent 49px,#d4af37 49px,#d4af37 50px);padding:20px;border-radius:8px}a{color:#d4af37}img{max-width:100%;border-radius:8px}</style></head><body><div class="note"><h1>${pageTitle}</h1>${fullBody}<p style="text-align:center"><a href="index.html">All Law Notes</a></p></div></body></html>`;

  window.open(`https://github.com/iowacattails/my-law-notes/new/main?filename=${filename}&value=${encodeURIComponent(html)}`,'_blank');
  alert("Image tabs already opened → commit them → then commit the note tab. Done!");
}
</script>
</body>
</html>
